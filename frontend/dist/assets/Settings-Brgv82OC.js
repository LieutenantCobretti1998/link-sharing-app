import{i as M,_ as h,j as e,g as W,f as D,M as P,l as u,Y as B,b as _,S as A,V as O,ac as $,$ as F}from"./index-D7ZcxJ6c.js";import{u as U}from"./index.esm-CflHE6-4.js";import{M as b}from"./MiniSpinner-sJpeD08U.js";import{u as w,B as p}from"./Button-BdNqCMaf.js";import{u as z,d as I}from"./Profiles-DqLLakWl.js";import{U as L}from"./UseHandleSessionExpired-BrClAK78.js";import"./utils-DhmRU0uH.js";function T({onProfileNameChange:r}){const t=localStorage.getItem("current-profile"),l=L(),i=M(),m=(t?JSON.parse(t):null).profile_name,{register:o,handleSubmit:a,formState:{errors:c}}=U(),{mutate:N,isLoading:x}=w({mutationFn:s=>z(s),onSuccess:s=>{r(s.new_name),h.success(s.message||"Profile name updated"),i(`/${s.new_name}/settings`,{replace:!0})},onError:s=>{s.message==="Session expired. Please log in again."&&l(),h.error(s.message||"An Error occurred")}}),g=()=>{i("/profiles")},{mutate:v,isLoading:d}=w({mutationFn:()=>I(),onSuccess:()=>{localStorage.removeItem("current-profile"),i("/profiles",{replace:!0})},onError:s=>{s.message==="Session expired. Please log in again."&&l(),h.error(s.message||"An Error occurred")}}),j=s=>{const k=s.change_user.trim();N(k)};return e.jsxs("form",{className:"flex flex-col gap-5 mt-10",onSubmit:a(j),children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:gap-10 items-start md:items-center",children:[e.jsx("label",{htmlFor:"change_user",className:"block font-instrumentSemiBold text-lightBlack-1 text-lg md:text-[1.2rem]",children:"Change Profile Name"}),e.jsx("input",{placeholder:m,type:"text",className:"pl-5 border-lightBlack-2 p-1 border-[0.5px] rounded-md focus:outline-none focus:border-primaryPurple focus:shadow-sm focus:shadow-primaryPurple w-full md:w-auto",id:"change_user",maxLength:"25",...o("change_user",{maxLength:"Max 25 char is allowed",validate:s=>s.trim()!==""||"Whitespaces are not allowed"})})]}),c.change_user&&e.jsx("p",{className:"text-red font-instrumentBold mt-2",children:c.change_user.message}),e.jsx("hr",{className:"my-5 border-t-[3px] border-light-grey-2 w-full"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{disabled:x||d,type:"delete",typeForm:!1,onclick:v,children:d?e.jsx(b,{}):"Delete"}),e.jsx(p,{type:"update",typeForm:!0,children:x?e.jsx(b,{}):"Update"})]}),e.jsx(p,{type:"change-profile",typeForm:!1,onclick:g,disabled:x||d,children:"Change Profile"})]})]})}const V=async()=>{const r=await fetch("/api/delete-account",{method:"DELETE",headers:{"X-CSRF-TOKEN":W()},credentials:"include"}),t=await r.json();if(!r.ok)throw r.status===401&&!await D()?new Error("Session expired. Please log in again."):new Error(t.error);return t};function H({setIsOpen:r,resetMenu:t}){const l=M(),i=P(),{setChosenProfile:f}=u.useContext(B),{mutate:m,isLoading:o}=w({mutationFn:()=>V(),onSuccess:a=>{f(null),i.clear(),l("/login"),h.success(a.message||"Profile name updated")},onError:a=>{h.error(a.message||"An Error occurred")}});return e.jsx("div",{className:"fixed inset-0 bg-lightBlack-1 bg-opacity-50 flex items-center justify-center z-[1000]",children:e.jsxs("div",{className:"max-xs:p-6 max-xs:max-w-[15rem] bg-white p-5 rounded-lg max-w-md w-full mx-auto text-center",children:[e.jsx("h2",{className:"max-xs:text-base text-xl font-bold mb-4",children:"Are you sure?"}),e.jsx("p",{className:"max-xs:text-[.9rem] mb-6",children:"Do you really want to delete your account? All profiles will be deletedðŸ¥²."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(p,{disabled:o,type:"confirmUserDeletion",onclick:()=>m(),children:o?e.jsx(b,{}):"Yes"}),e.jsx(p,{disabled:o,type:"cancelUserDeletion",onclick:()=>{r(!1),t("Manage Profile")},children:"No"})]})]})})}function X(){const[r,t]=u.useState("Manage Profile"),l=P(),{setChosenProfile:i}=u.useContext(B),f=_(),[m,o]=u.useState(!1),[a,c]=u.useState(!1),N=M(),x=L(),[g,v]=u.useState(()=>{const n=localStorage.getItem("current-profile");return n?JSON.parse(n):null}),d=g.profile_name,j=g.current_user,s=n=>{const C={...g,profile_name:n};v(C),localStorage.setItem("current-profile",JSON.stringify(C)),f($(n))},{mutate:k,isLoading:S}=w({mutationFn:()=>F(),onSuccess:()=>{N("/login",{replace:!0}),i(null),l.clear()},onError:n=>{n.message==="Session expired. Please log in again."&&x(),h.error(n.message||"An Error occurred")}}),y=()=>{t("deleteAccount"),o(!0)},E=()=>{switch(r){case"Manage Profile":return e.jsx(T,{onProfileNameChange:s});default:return null}};return e.jsxs("main",{className:"flex justify-center items-center h-screen bg-grey",children:[m&&e.jsx(H,{setIsOpen:o,resetMenu:t}),S?e.jsx(A,{}):e.jsxs("section",{className:"bg-white flex rounded-md shadow-sm overflow-hidden w-[80%] max-lg:flex-col max-lg:w-full",children:[e.jsxs("aside",{className:"bg-light-grey-2 p-6 w-2/4 border-r border-light-grey hidden lg:block",children:[e.jsxs("div",{className:"mb-10",children:[e.jsxs("h3",{className:"max-xs:text-[.8rem] text-lg text-lightBlack-3 mb-2",children:["Current User:"," ",e.jsx("strong",{className:"text-lightBlack-1",children:j})]}),e.jsxs("h3",{className:"max-xs:text-[.8rem] text-lg text-lightBlack-3",children:["Chosen Profile:"," ",e.jsx("strong",{className:"text-lightBlack-1",children:d})]})]}),e.jsxs("ul",{children:[e.jsxs("li",{className:`flex items-center gap-3 p-2 my-5 ${r==="Manage Profile"?"bg-grey cursor-default":"hover:bg-grey cursor-pointer"} rounded-md group transition-colors duration-300`,onClick:()=>t("Manage Profile"),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:`ionicon max-sm:w-4 w-5 ${r==="Manage Profile"?"text-lightBlack-1":"text-lightBlack-3 group-hover:text-lightBlack-1"} transition-colors duration-300`,viewBox:"0 0 512 512",children:[e.jsx("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),e.jsx("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor",strokeMiterlimit:"10",strokeWidth:"32"})]}),e.jsx("span",{className:`${r==="Manage Profile"?"text-lightBlack-1":"text-lightBlack-3 group-hover:text-lightBlack-1"} max-sm:text-[.8rem] transition-colors duration-300`,children:"Manage Profile"})]}),e.jsxs("li",{className:`flex items-center gap-3 p-2 ${r==="logOut"?"bg-grey cursor-default":"hover:bg-grey cursor-pointer"} rounded-md group transition-colors duration-300`,onClick:()=>k(),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-5 text-red",viewBox:"0 0 512 512",children:e.jsx("path",{d:"M304 336v40a40 40 0 01-40 40H104a40 40 0 01-40-40V136a40 40 0 0140-40h152c22.09 0 48 17.91 48 40v40M368 336l80-80-80-80M176 256h256",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"})}),e.jsx("span",{className:"text-red transition-colors duration-300",children:"LogOut"})]}),e.jsxs("li",{className:`flex items-center gap-3 p-2 ${r==="deleteAccount"?"bg-grey cursor-default":"hover:bg-grey cursor-pointer"} rounded-md group transition-colors duration-300`,onClick:()=>y(),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-5 text-red",viewBox:"0 0 512 512",children:[e.jsx("path",{d:"M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M80 112h352"}),e.jsx("path",{d:"M192 112V72h0a23.93 23.93 0 0124-24h80a23.93 23.93 0 0124 24h0v40M256 176v224M184 176l8 224M328 176l-8 224",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"})]}),e.jsx("span",{className:"text-red transition-colors duration-300",children:"Delete Account"})]})]})]}),a&&e.jsxs("aside",{className:"bg-light-grey-2 p-6 w-full border-b border-light-grey fixed inset-0 z-10 overflow-y-auto lg:hidden",children:[e.jsx("button",{className:"mb-4",onClick:()=>c(!1),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-6 h-6",viewBox:"0 0 512 512",children:[e.jsx("title",{children:"Close"}),e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M368 368L144 144M368 144L144 368"})]})}),e.jsxs("div",{className:"mb-10",children:[e.jsxs("h3",{className:"text-lg text-lightBlack-3 mb-2",children:["Current User:"," ",e.jsx("strong",{className:"text-lightBlack-1",children:j})]}),e.jsxs("h3",{className:"text-lg text-lightBlack-3",children:["Chosen Profile:"," ",e.jsx("strong",{className:"text-lightBlack-1",children:d})]})]}),e.jsxs("ul",{children:[e.jsxs("li",{className:`flex items-center gap-3 p-2 my-5 ${r==="Manage Profile"?"bg-grey cursor-default":"hover:bg-grey cursor-pointer"} rounded-md group transition-colors duration-300`,onClick:()=>{t("Manage Profile"),c(!1)},children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:`ionicon w-5 ${r==="Manage Profile"?"text-lightBlack-1":"text-lightBlack-3 group-hover:text-lightBlack-1"} transition-colors duration-300`,viewBox:"0 0 512 512",children:[e.jsx("path",{d:"M344 144c-3.92 52.87-44 96-88 96s-84.15-43.12-88-96c-4-55 35-96 88-96s92 42 88 96z",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),e.jsx("path",{d:"M256 304c-87 0-175.3 48-191.64 138.6C62.39 453.52 68.57 464 80 464h352c11.44 0 17.62-10.48 15.65-21.4C431.3 352 343 304 256 304z",fill:"none",stroke:"currentColor",strokeMiterlimit:"10",strokeWidth:"32"})]}),e.jsx("span",{className:`${r==="Manage Profile"?"text-lightBlack-1":"text-lightBlack-3 group-hover:text-lightBlack-1"} transition-colors duration-300`,children:"Manage Profile"})]}),e.jsxs("li",{className:`flex items-center gap-3 p-2 ${r==="logOut"?"bg-grey cursor-default":"hover:bg-grey cursor-pointer"} rounded-md group transition-colors duration-300`,onClick:()=>{k(),c(!1)},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-5 text-red",viewBox:"0 0 512 512",children:e.jsx("path",{d:"M304 336v40a40 40 0 01-40 40H104a40 40 0 01-40-40V136a40 40 0 0140-40h152c22.09 0 48 17.91 48 40v40M368 336l80-80-80-80M176 256h256",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"})}),e.jsx("span",{className:"text-red transition-colors duration-300",children:"LogOut"})]}),e.jsxs("li",{className:`flex items-center gap-3 p-2 ${r==="deleteAccount"?"bg-grey cursor-default":"hover:bg-grey cursor-pointer"} rounded-md group transition-colors duration-300`,onClick:()=>y(),children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-5 text-red",viewBox:"0 0 512 512",children:[e.jsx("path",{d:"M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M80 112h352"}),e.jsx("path",{d:"M192 112V72h0a23.93 23.93 0 0124-24h80a23.93 23.93 0 0124 24h0v40M256 176v224M184 176l8 224M328 176l-8 224",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"})]}),e.jsx("span",{className:"text-red transition-colors duration-300",children:"Delete Account"})]})]})]}),e.jsxs("div",{className:"h-[720px] p-8 w-full relative max-lg:h-auto",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{className:"lg:hidden",onClick:()=>c(!0),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-6 h-6",viewBox:"0 0 512 512",children:[e.jsx("title",{children:"Menu"}),e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"M80 160h352M80 256h352M80 352h352"})]})}),e.jsx("h1",{className:"max-sm:text-base font-instrumentBold text-3xl",children:r}),e.jsx(O,{to:"/",className:"group",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"ionicon w-10",viewBox:"0 0 512 512",children:[e.jsx("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z",fill:"lightGrey",stroke:"lightGrey",strokeMiterlimit:"10",strokeWidth:"32",className:"group-hover:fill-primaryPurple group-hover:stroke-primaryPurple transition-colors duration-300"}),e.jsx("path",{fill:"none",stroke:"grey",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M320 320L192 192M192 320l128-128",className:"group-hover:stroke-white transition-colors duration-300"})]})})]}),e.jsx("div",{className:"inset-x-0 absolute",children:e.jsx("hr",{className:"my-3 border-t-[3px] border-light-grey-2 w-full"})}),E()]})]})]})}export{X as default};
